# 一、容器介绍

## 1.1 容器本质
**核心定义**：容器是一种操作系统层面的虚拟化技术，通过对 **进程隔离机制（namespace）和资源限制（CGroup）**，让它在 **共享主机内核（共享宿主机 bootfs）的环境** 下，获得独立的运行视图与资源边界。

---

### 与传统虚拟机对比

| 特性       | 虚拟机 (VM)                 | 容器 (Container)         |
| ---------- | --------------------------- | ------------------------ |
| 虚拟化层级 | 硬件级虚拟化 (Hypervisor)   | 操作系统级虚拟化         |
| 资源占用   | GB 级内存、完整系统镜像     | MB 级内存、共享内核      |
| 启动速度   | 分钟级                      | 秒级 (0.1~1s)            |
| 性能损耗   | 15% ~ 30%                   | < 5%                     |
| 隔离性     | 硬件级强隔离                | 进程级隔离               |

---

# 二、容器三大核心

容器说白了就是追求一个轻量级的虚拟化方案，来达到隔离的目的（同时提高硬件利用率）。  
这个空间隔离就是容器技术的第一个核心技术：**namespace 名称空间**。

但是光有隔离还不够，因为空间隔离之后，多个容器寄生在同一台机器上，虽然是隔离的，但是归根结底还是在共享宿主机的硬件资源。  
举例来说，如果内存不加限制，当不足时会触发 **Linux OOM（Out of Memory）机制**，强制杀掉一些进程。

所以，容器技术在 **隔离** 的基础上引入了 **CGroup 机制**，对资源进行限制（包括磁盘、内存、CPU 等）。

另一方面，一个容器的启动需要镜像，这与操作系统镜像还是有区别的：

- **系统镜像的主要构成** = `bootfs（包含内核） + rootfs`
- 而容器镜像 **没有 bootfs**，只有 **rootfs**
- 容器的 rootfs 文件系统并非 ext4、xfs，而是使用 **联合文件系统（UnionFS）** 技术，其特点是“多个目录联合挂载到同一个目录”，而不是复制一份。

---

## 容器技术的三大核心：

1. **Namespace（名称空间）**
  - 保证多个容器之间的运行环境互相隔离
  - 每个进程看起来都有自己独立的系统资源和运行环境
  - 进程和应用程序像运行在独立系统中一样

2. **CGroup（资源限制）**
  - 容器的本质就是进程，如果不加限制，可能会耗尽 CPU/内存/磁盘/网络等资源
  - OOM 机制在内存不足时会随机杀掉进程，导致错误
  - CGroup 机制可限制容器使用的资源，让系统更加可控
  - 例：Docker 使用 Linux CGroup 来限制容器资源

3. **UnionFS（联合文件系统）**
  - 支持多个目录（分支）挂载到同一个目录下
  - 目录在物理位置上分开，但逻辑上合为一体
  - 多个容器可以共享同一份镜像，而不是像传统 VM 每个实例都带完整的系统
  - 大幅减少冗余、节省存储空间

---
